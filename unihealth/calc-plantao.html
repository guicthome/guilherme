<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <title>Calculadora Plantões Médicos | AxiaCare Pro</title>
  <meta name="description" content="Sistema profissional de análise preditiva orçamentária de plantões médicos com modelagem estatística de variabilidade.">
  <meta name="theme-color" content="#196396">

  <link rel="icon" href="https://axcare.com.br/favicon.ico">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --ax-primary: #196396;
      --ax-primary-light: #2b7ab8;
      --ax-primary-dark: #0f4764;
      --ax-mint: #a6d8c0;
      --ax-cream: #f8f5f0;
      --ax-border: #e5e7eb;
      --ax-ok: #065f46;
      --ax-ok-light: #10b981;
      --ax-warn: #b91c1c;
      --ax-warn-light: #ef4444;
      --ax-shadow: 0 10px 30px rgba(0,0,0,.08);
      --ax-shadow-lg: 0 20px 40px rgba(0,0,0,.12);

      --serie1: #196396;
      --serie1-bg: rgba(25, 99, 150, 0.1);
      --serie2: #10b981;
      --serie2-bg: rgba(16, 185, 129, 0.1);
      --serie3: #ff8f00;
      --serie3-bg: rgba(255, 143, 0, 0.1);

      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-tertiary: #64748b;
      --border-color: #e2e8f0;
      
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
    }

    [data-theme="dark"] {
      --ax-primary: #3b9dd8;
      --ax-primary-light: #5bb2e8;
      --ax-border: #374151;
      --ax-shadow: 0 10px 30px rgba(0,0,0,.3);
      --ax-shadow-lg: 0 20px 40px rgba(0,0,0,.4);
      
      --bg-primary: #1e293b;
      --bg-secondary: #0f172a;
      --bg-tertiary: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --text-tertiary: #94a3b8;
      --border-color: #334155;
      
      --serie1-bg: rgba(59, 157, 216, 0.15);
      --serie2-bg: rgba(16, 185, 129, 0.15);
      --serie3-bg: rgba(255, 143, 0, 0.15);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      overflow-x: hidden;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      color: var(--text-primary);
      background: var(--bg-secondary);
      line-height: 1.6;
      transition: background var(--transition-normal), color var(--transition-normal);
      -webkit-tap-highlight-color: transparent;
    }

    .hero {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: var(--bg-primary);
      backdrop-filter: blur(12px) saturate(150%);
      border-bottom: 1px solid var(--border-color);
      transition: box-shadow var(--transition-normal), background var(--transition-normal);
    }

    .hero.scrolled {
      box-shadow: var(--ax-shadow);
    }

    .hero-inner {
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px 24px;
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 24px;
    }

    .brand-container {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .brand-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      transition: transform var(--transition-fast), opacity var(--transition-fast);
    }

    .brand-link:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .brand-logo {
      height: 48px;
      width: auto;
    }

    .hero-title {
      text-align: center;
    }

    .hero-title h1 {
      font-size: 28px;
      font-weight: 900;
      color: var(--ax-primary);
      letter-spacing: -0.02em;
      margin-bottom: 4px;
    }

    .hero-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .hero-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .theme-toggle {
      width: 40px;
      height: 40px;
      min-width: 40px;
      min-height: 40px;
      border-radius: 10px;
      border: 1px solid var(--border-color);
      background: var(--bg-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
      font-size: 18px;
      -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 768px) {
      .theme-toggle {
        width: 44px;
        height: 44px;
        min-width: 44px;
        min-height: 44px;
      }
    }

    .theme-toggle:hover {
      background: var(--bg-tertiary);
      transform: scale(1.05);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
    }

    .card {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      border-radius: 20px;
      box-shadow: var(--ax-shadow);
      margin-bottom: 24px;
      transition: all var(--transition-normal);
    }

    .card:hover {
      box-shadow: var(--ax-shadow-lg);
    }

    .card-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .card-header > div {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .card-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .card-body {
      padding: 24px;
    }

    /* Introdução */
    .intro-section {
      background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
      padding: 28px;
      border-radius: 16px;
      border: 1px solid var(--border-color);
      margin-bottom: 24px;
    }

    .intro-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
    }

    .intro-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .intro-text {
      font-size: 14px;
      line-height: 1.7;
      color: var(--text-secondary);
    }

    .btn-info {
      background: var(--ax-primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }

    .btn-info:hover {
      background: var(--ax-primary-light);
      transform: translateY(-1px);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      animation: fadeIn 0.3s ease;
    }

    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: var(--bg-primary);
      border-radius: 20px;
      max-width: 800px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: var(--ax-shadow-lg);
      animation: slideUp 0.3s ease;
    }

    .modal-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: var(--bg-primary);
      z-index: 10;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .modal-close {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      border: none;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 20px;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .modal-close:hover {
      background: var(--border-color);
      transform: rotate(90deg);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-body p {
      font-size: 14px;
      line-height: 1.8;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    .modal-body strong {
      color: var(--text-primary);
      font-weight: 700;
    }

    .modal-formula {
      background: var(--bg-secondary);
      border-left: 4px solid var(--ax-primary);
      padding: 16px;
      margin: 16px 0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      color: var(--text-primary);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* Indexador */
    .indexador-section {
      background: linear-gradient(135deg, var(--ax-primary) 0%, var(--ax-primary-dark) 100%);
      padding: 28px;
      border-radius: 16px;
      color: white;
      margin-bottom: 24px;
    }

    .indexador-title {
      font-size: 18px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .indexador-subtitle {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 20px;
    }

    .indexador-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
    }

    .indexador-field {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      padding: 16px;
    }

    .indexador-label {
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
      opacity: 0.9;
    }

    .indexador-hint {
      font-size: 11px;
      opacity: 0.8;
      margin-top: 6px;
      line-height: 1.4;
    }

    .indexador-input-wrapper {
      display: flex;
      align-items: stretch;
    }

    .indexador-prefix {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-right: none;
      padding: 0 14px;
      display: flex;
      align-items: center;
      border-radius: 10px 0 0 10px;
      font-weight: 700;
      font-size: 15px;
    }

    .indexador-input {
      flex: 1;
      padding: 12px 14px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-left: none;
      border-radius: 0 10px 10px 0;
      font-size: 16px;
      font-weight: 700;
      background: rgba(255, 255, 255, 0.95);
      color: var(--ax-primary-dark);
      transition: all var(--transition-fast);
      font-family: inherit;
    }

    .indexador-input:focus {
      outline: none;
      border-color: rgba(255, 255, 255, 0.6);
      background: white;
      box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.2);
    }

    .indexador-actions {
      display: flex;
      gap: 10px;
      margin-top: 16px;
      justify-content: flex-end;
    }

    .btn-light {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 10px 20px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      transition: all var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-light:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-1px);
    }

    /* Especialidades */
    .especialidades-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
      gap: 20px;
    }

    .esp-card {
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .esp-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--esp-color);
      transition: width var(--transition-fast);
    }

    .esp-card:hover {
      border-color: var(--esp-color);
      transform: translateY(-2px);
      box-shadow: var(--ax-shadow);
    }

    .esp-card:hover::before {
      width: 8px;
    }

    .esp-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .esp-title {
      font-size: 16px;
      font-weight: 800;
      color: var(--esp-color);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .esp-badge {
      display: inline-block;
      padding: 3px 8px;
      background: var(--esp-color);
      color: white;
      border-radius: 6px;
      font-size: 9px;
      font-weight: 600;
      letter-spacing: 0.03em;
      opacity: 0.85;
    }

    .toggle-switch {
      position: relative;
      width: 52px;
      height: 28px;
      min-width: 52px;
      min-height: 28px;
      -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 768px) {
      .toggle-switch {
        width: 56px;
        height: 32px;
        min-width: 56px;
        min-height: 32px;
      }

      .toggle-slider::before {
        height: 24px;
        width: 24px;
      }

      .toggle-switch input:checked + .toggle-slider::before {
        transform: translateX(24px);
      }
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--border-color);
      border-radius: 28px;
      transition: var(--transition-normal);
    }

    .toggle-slider::before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background: white;
      border-radius: 50%;
      transition: var(--transition-normal);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .toggle-switch input:checked + .toggle-slider {
      background: var(--esp-color);
    }

    .toggle-switch input:checked + .toggle-slider::before {
      transform: translateX(24px);
    }

    .esp-fields {
      display: grid;
      gap: 16px;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .field-label {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .field-hint {
      font-size: 12px;
      color: var(--text-tertiary);
      line-height: 1.4;
    }

    .input-field {
      flex: 1;
      padding: 12px 14px;
      border: 2px solid var(--border-color);
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      background: var(--bg-primary);
      transition: all var(--transition-fast);
      font-family: inherit;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--ax-primary);
      box-shadow: 0 0 0 4px rgba(25, 99, 150, 0.1);
    }

    .input-field:disabled,
    .input-field[readonly] {
      background: var(--bg-tertiary);
      cursor: not-allowed;
      opacity: 0.7;
    }

    select.input-field {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23475569' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }

    /* Campo customizado para "Outra" */
    .custom-name-field {
      display: none;
      margin-top: 12px;
    }

    .custom-name-field.active {
      display: block;
    }

    /* Controle Numérico */
    .number-control {
      display: flex;
      align-items: stretch;
      background: var(--bg-primary);
      border: 2px solid var(--border-color);
      border-radius: 10px;
      overflow: hidden;
    }

    .number-btn {
      width: 40px;
      border: none;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .number-btn:hover {
      background: var(--border-color);
    }

    .number-btn:active {
      transform: scale(0.95);
    }

    .number-input {
      flex: 1;
      border: none;
      border-left: 2px solid var(--border-color);
      border-right: 2px solid var(--border-color);
      text-align: center;
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
      background: var(--bg-primary);
      padding: 12px;
    }

    .number-input:focus {
      outline: none;
      background: var(--bg-tertiary);
    }

    .budget-display {
      background: linear-gradient(135deg, var(--esp-color) 0%, var(--esp-color-dark, var(--esp-color)) 100%);
      color: white;
      padding: 16px;
      border-radius: 12px;
      text-align: center;
      margin-top: 12px;
    }

    .budget-label {
      font-size: 12px;
      font-weight: 600;
      opacity: 0.9;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .budget-value {
      font-size: 24px;
      font-weight: 900;
      margin-top: 4px;
    }

    .budget-detail {
      font-size: 11px;
      opacity: 0.85;
      margin-top: 6px;
    }

    /* Análise Estatística */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: 14px;
      padding: 24px;
      transition: all var(--transition-fast);
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--ax-shadow);
      border-color: var(--ax-primary);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
    }

    .stat-label {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .stat-period {
      font-size: 11px;
      font-weight: 700;
      padding: 4px 8px;
      background: var(--bg-tertiary);
      border-radius: 6px;
      color: var(--text-secondary);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 900;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .stat-description {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .stat-alert {
      margin-top: 12px;
      padding: 10px;
      background: var(--ax-warn-light);
      color: white;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      text-align: center;
    }

    /* Tabela */
    .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      border-radius: 12px;
      border: 1px solid var(--border-color);
      max-width: 100%;
    }

    @media (max-width: 768px) {
      .table-container {
        margin: 0 -16px;
        border-radius: 0;
        border-left: none;
        border-right: none;
      }
    }

    .data-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    .data-table thead th {
      position: sticky;
      top: 0;
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 12px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 16px 12px;
      text-align: left;
      border-bottom: 2px solid var(--border-color);
      white-space: nowrap;
      z-index: 10;
    }

    .data-table thead th.numeric {
      text-align: right;
    }

    .data-table tbody td {
      padding: 14px 12px;
      border-bottom: 1px solid var(--border-color);
      font-size: 14px;
      color: var(--text-primary);
      transition: background var(--transition-fast);
    }

    .data-table tbody tr:hover {
      background: var(--bg-tertiary);
    }

    .data-table tbody tr:last-child td {
      border-bottom: none;
    }

    .numeric {
      text-align: right;
      font-variant-numeric: tabular-nums;
    }

    .month-cell {
      font-weight: 700;
      color: var(--text-primary);
    }

    .value-positive {
      color: var(--ax-warn);
      font-weight: 700;
    }

    .value-negative {
      color: var(--ax-ok);
      font-weight: 700;
    }

    .value-neutral {
      color: var(--text-tertiary);
    }

    .holidays-cell {
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Botões */
    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      white-space: nowrap;
    }

    .btn:active {
      transform: scale(0.97);
    }

    .btn-primary {
      background: var(--ax-primary);
      color: white;
      border-color: var(--ax-primary);
    }

    .btn-primary:hover {
      background: var(--ax-primary-light);
      box-shadow: 0 8px 20px rgba(25, 99, 150, 0.3);
    }

    .btn-primary.btn-simulator {
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      border-color: #8b5cf6;
      position: relative;
      overflow: hidden;
    }

    .btn-primary.btn-simulator::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn-primary.btn-simulator:hover::before {
      left: 100%;
    }

    .btn-primary.btn-simulator:hover {
      background: linear-gradient(135deg, #9f7aea 0%, #7c3aed 100%);
      box-shadow: 0 8px 20px rgba(139, 92, 246, 0.4);
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border-color: var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-tertiary);
      box-shadow: var(--ax-shadow);
    }

    /* Gráficos */
    .chart-container {
      position: relative;
      height: 450px;
      width: 100%;
    }

    @media (max-width: 768px) {
      .chart-container {
        height: 320px;
      }
    }

    @media (max-width: 480px) {
      .chart-container {
        height: 280px;
      }
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: 8px;
      padding: 0 24px;
      overflow-x: auto;
      scrollbar-width: thin;
    }

    .tab {
      padding: 12px 20px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all var(--transition-fast);
      white-space: nowrap;
    }

    .tab:hover {
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }

    .tab.active {
      color: var(--ax-primary);
      border-bottom-color: var(--ax-primary);
    }

    .tab.tab-chart {
      position: relative;
      background: linear-gradient(to bottom, transparent 0%, rgba(139, 92, 246, 0.05) 100%);
    }

    .tab.tab-chart:hover {
      background: linear-gradient(to bottom, rgba(139, 92, 246, 0.05) 0%, rgba(139, 92, 246, 0.1) 100%);
    }

    .tab.tab-chart.active {
      background: linear-gradient(to bottom, rgba(25, 99, 150, 0.05) 0%, rgba(25, 99, 150, 0.08) 100%);
    }

    .tab.tab-chart::after {
      content: '📊';
      margin-left: 6px;
      font-size: 14px;
      transition: transform var(--transition-fast);
    }

    .tab.tab-chart:hover::after {
      transform: scale(1.15);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Footer */
    .footer {
      margin-top: 40px;
      padding: 25px 15px;
      background-color: #f8f5f0;
      text-align: center;
      font-family: Verdana, sans-serif;
      border-top: 2px solid #006b68;
    }
    .footer-logo {
      width: 140px;
      margin: 0 auto 10px auto;
      display: block;
    }
    .footer-title {
      font-size: 15px;
      font-weight: bold;
      color: #333;
      margin: 10px 0 18px;
    }
    .footer-links,
    .footer-social {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .footer-links a,
    .footer-social a {
      color: #004E4C;
      text-decoration: none;
      position: relative;
      padding: 0 4px;
    }
    .footer-links a:hover,
    .footer-social a:hover {
      color: #002c2a;
      text-decoration: underline;
    }
    .footer .separator {
      color: #bbb;
      margin: 0 4px;
    }
    .footer-copyright {
      margin-top: 18px;
      font-size: 11px;
      color: #999;
    }

    /* Toast */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 24px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 400px;
    }

    .toast {
      background: var(--bg-primary);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 16px 20px;
      box-shadow: var(--ax-shadow-lg);
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideInRight 0.3s ease;
    }

    .toast.success {
      border-color: var(--ax-ok-light);
    }

    .toast-message {
      flex: 1;
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .hero-inner {
        grid-template-columns: 1fr;
        gap: 16px;
        text-align: center;
      }

      .brand-container,
      .hero-actions {
        justify-content: center;
      }

      .especialidades-grid {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      .card-header,
      .card-body {
        padding: 16px;
      }

      .hero-title h1 {
        font-size: 20px;
      }

      .hero-subtitle {
        font-size: 13px;
      }

      .button-group {
        width: 100%;
      }

      .btn {
        flex: 1;
        justify-content: center;
        font-size: 13px;
        padding: 10px 16px;
      }

      .toast-container {
        right: 12px;
        left: 12px;
        max-width: none;
        top: 70px;
      }

      .intro-header {
        flex-direction: column;
        align-items: stretch;
      }

      .intro-title {
        font-size: 16px;
        text-align: center;
      }

      .btn-info {
        width: 100%;
      }

      .indexador-grid {
        grid-template-columns: 1fr;
      }

      .indexador-section {
        padding: 20px;
      }

      .modal-content {
        width: 95%;
        max-height: 85vh;
      }

      .modal-header,
      .modal-body {
        padding: 16px;
      }

      .modal-title {
        font-size: 18px;
      }

      .tabs {
        padding: 0 16px;
        gap: 4px;
      }

      .tab {
        font-size: 13px;
        padding: 10px 14px;
      }

      .table-container {
        font-size: 12px;
      }

      .data-table thead th {
        padding: 12px 8px;
        font-size: 10px;
      }

      .data-table tbody td {
        padding: 10px 8px;
        font-size: 12px;
      }

      .stat-card {
        padding: 16px;
      }

      .stat-value {
        font-size: 28px;
      }

      .card-title {
        font-size: 18px;
      }

      .esp-card {
        padding: 16px;
      }

      .number-control {
        touch-action: manipulation;
      }

      .number-btn {
        min-width: 44px;
        min-height: 44px;
        font-size: 20px;
      }

      .number-input {
        min-height: 44px;
        font-size: 16px;
      }
    }

    @media (max-width: 480px) {
      .hero-title h1 {
        font-size: 18px;
      }

      .hero-subtitle {
        font-size: 12px;
      }

      .brand-logo {
        height: 40px;
      }

      .intro-text {
        font-size: 13px;
      }

      .indexador-title {
        font-size: 16px;
      }

      .indexador-subtitle {
        font-size: 12px;
      }

      .card-title {
        font-size: 16px;
      }

      .especialidades-grid {
        gap: 16px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .table-container {
        border-radius: 8px;
      }

      .data-table {
        font-size: 11px;
      }

      .data-table thead th {
        padding: 10px 6px;
        font-size: 9px;
      }

      .data-table tbody td {
        padding: 8px 6px;
        font-size: 11px;
      }

      .modal-content {
        width: 98%;
        max-height: 90vh;
      }

      .footer {
        padding: 20px 12px;
      }

      .footer-logo {
        width: 120px;
      }

      .footer-title {
        font-size: 14px;
      }

      .footer-links,
      .footer-social {
        font-size: 13px;
        flex-direction: column;
        gap: 6px;
      }

      .footer .separator {
        display: none;
      }
    }

    /* Impressão */
    @media print {
      @page {
        size: A4 landscape;
        margin: 15mm;
      }

      body {
        background: white;
      }

      .hero {
        position: static;
        box-shadow: none;
        border-bottom: 2px solid #000;
      }

      .theme-toggle,
      .btn,
      .tabs,
      .btn-info {
        display: none !important;
      }

      .card {
        box-shadow: none;
        page-break-inside: avoid;
        margin-bottom: 20px;
      }

      .chart-container {
        height: 300px;
      }

      .data-table {
        font-size: 10px;
      }

      .data-table thead th,
      .data-table tbody td {
        padding: 8px 6px;
      }
    }

    *:focus-visible {
      outline: 3px solid var(--ax-primary);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <div class="toast-container" id="toastContainer"></div>

  <!-- Modal Informações -->
  <div class="modal" id="infoModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Fundamentação Metodológica Completa</h3>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <div class="modal-body">
        <p>
          Os plantões médicos apresentam <strong>variabilidade orçamentária intrínseca</strong> ao longo do ano devido à distribuição não uniforme de dias úteis, finais de semana e feriados nacionais em cada mês. Esta variabilidade decorre da aplicação de <strong>valores diferenciados de consulta</strong> conforme o período de atendimento: consultas realizadas em horário especial (noturno, finais de semana e feriados) recebem acréscimo remuneratório em relação às consultas tradicionais (diurnas em dias úteis).
        </p>
        <p>
          A <strong>visão preditiva orçamentária</strong> busca o mais alto nível de precisão na estimativa de custos mensais, considerando a composição exata de cada período e permitindo a identificação de <strong>desvios estatisticamente significativos</strong> em relação ao orçamento base. O modelo estabelece intervalos de confiança e limites de alerta para variações que excedam os parâmetros esperados, possibilitando <strong>controle orçamentário proativo</strong> e ajustes estratégicos tempestivos.
        </p>
        <div class="modal-formula">
          Custo Mensal (Cₘ) = N × [(W - H) × Rₜ + (D + S + H) × Rₑ]<br><br>
          Onde:<br>
          • N = Número de consultas por plantão de 12h<br>
          • W = Dias úteis no mês<br>
          • H = Feriados em dias úteis<br>
          • S = Dias de fins de semana<br>
          • D = Total de dias no mês<br>
          • Rₜ = Valor consulta tradicional<br>
          • Rₑ = Valor consulta especial
        </div>
        <p>
          O <strong>orçamento base (X)</strong> é calculado considerando uma distribuição média mensal de 22 consultas tradicionais e 38 consultas especiais, permitindo análise comparativa de variações percentuais em relação a este parâmetro de referência.
        </p>
        <p>
          Para plantões em regime de <strong>sobreaviso</strong>, o modelo aplica um fator de 30% sobre o valor do plantão presencial, refletindo a disponibilidade remota com possibilidade de acionamento. No caso de escalas mistas (exemplo: Cinderela), o cálculo combina horas presenciais com horas de sobreaviso proporcionalmente.
        </p>
        <p>
          A análise estatística utiliza <strong>desvio padrão</strong> para estabelecer limites de alerta. Variações superiores a ±2σ (dois desvios padrão) da média são sinalizadas como potenciais anomalias que requerem investigação, permitindo identificação precoce de distorções orçamentárias antes que impactem significativamente o planejamento financeiro.
        </p>
      </div>
    </div>
  </div>

  <!-- Modal Simulador -->
  <div class="modal" id="simuladorModal">
    <div class="modal-content" style="max-width: 900px;">
      <div class="modal-header">
        <h3 class="modal-title">Simulador de Novo Plantão</h3>
        <button class="modal-close" id="closeSimulador">&times;</button>
      </div>
      <div class="modal-body">
        <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); padding: 24px; border-radius: 12px; margin-bottom: 20px;">
          <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">
            <strong>Configure um novo plantão do zero</strong> e observe como as diferentes composições de turnos impactam o custo ao longo do ano.
          </p>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 20px;">
            <div class="field-group">
              <label class="field-label">Nome do Plantão</label>
              <input type="text" class="input-field" id="simNome" placeholder="Ex: Clínica Médica Noturna">
            </div>
            
            <div class="field-group">
              <label class="field-label">Número de Médicos</label>
              <div class="number-control">
                <button class="number-btn" data-sim="medicos" data-action="decrease">−</button>
                <input type="number" class="number-input" step="1" min="1" value="1" id="simMedicos">
                <button class="number-btn" data-sim="medicos" data-action="increase">+</button>
              </div>
              <span class="field-hint">Quantos médicos atuam simultaneamente neste plantão</span>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 20px;">
            <div class="field-group">
              <label class="field-label">Consultas Tradicionais <span style="opacity: 0.5; font-size: 11px;">(por médico)</span></label>
              <div class="number-control">
                <button class="number-btn" data-sim="trad" data-action="decrease">−</button>
                <input type="number" class="number-input" step="0.5" min="0" value="0" id="simTrad">
                <button class="number-btn" data-sim="trad" data-action="increase">+</button>
              </div>
              <span class="field-hint">Turnos em horário comercial (dias úteis)</span>
            </div>

            <div class="field-group">
              <label class="field-label">Consultas Especiais <span style="opacity: 0.5; font-size: 11px;">(por médico)</span></label>
              <div class="number-control">
                <button class="number-btn" data-sim="esp" data-action="decrease">−</button>
                <input type="number" class="number-input" step="0.5" min="0" value="0" id="simEsp">
                <button class="number-btn" data-sim="esp" data-action="increase">+</button>
              </div>
              <span class="field-hint">Turnos noturnos, finais de semana e feriados</span>
            </div>
          </div>

          <div style="background: white; border-radius: 10px; padding: 20px; margin-bottom: 20px; border: 2px solid var(--ax-primary);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <span style="font-size: 13px; font-weight: 700; color: var(--text-secondary);">CUSTO MENSAL ESTIMADO</span>
              <span style="font-size: 28px; font-weight: 900; color: var(--ax-primary);" id="simOrcamentoBase">R$ 0,00</span>
            </div>
            <div style="font-size: 11px; color: var(--text-tertiary);">
              Considerando mês com 22 dias úteis e 8 dias de final de semana, sem feriados
            </div>
          </div>

          <div style="display: flex; gap: 12px;">
            <button class="btn btn-secondary" id="btnResetSimulador" style="flex: 1;">
              Limpar Campos
            </button>
            <button class="btn btn-primary" id="btnAplicarSimulador" style="flex: 2;">
              Aplicar ao Slot 1 para Análise
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <header class="hero" id="hero">
    <div class="hero-inner">
      <div class="brand-container">
        <a class="brand-link" href="https://axcare.com.br" target="_blank" rel="noopener" aria-label="AxiaCare">
          <img class="brand-logo" src="https://i.imgur.com/yAUQciP.png" alt="AxiaCare">
        </a>
      </div>
      <div class="hero-title">
        <h1>Calculadora Plantões Médicos</h1>
        <p class="hero-subtitle">Análise Preditiva Orçamentária | 2025 - 2026</p>
      </div>
      <div class="hero-actions">
        <button class="theme-toggle" id="themeToggle" aria-label="Alternar tema">
          <span id="themeIcon">D</span>
        </button>
        <a class="brand-link" href="https://icds.org.br/hospital-unimed-governador-valadares/" target="_blank" rel="noopener" aria-label="ICDS Hospital">
          <img class="brand-logo" src="https://i.imgur.com/XouXBck.png" alt="ICDS Hospital">
        </a>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Introdução -->
    <section class="intro-section">
      <div class="intro-header">
        <h2 class="intro-title">Fundamentação do Modelo</h2>
        <button class="btn-info" id="openModal">Mais Informações</button>
      </div>
      <p class="intro-text">
        Esta calculadora foi parametrizada considerando a variação do custo de plantões médicos baseada na proporção de turnos com "horário tradicional" versus "horário especial". O indexador principal varia na ordem de 30% (R$ 48,50 tradicional para R$ 63,05 especial), refletindo o acréscimo aplicável em períodos noturnos, finais de semana e feriados. A distribuição média de 22 turnos tradicionais e 38 turnos especiais por mês (totalizando 60 turnos em plantões de 12h) serve como base de referência para cálculo do orçamento padrão. Meses com maior concentração de finais de semana ou feriados em dias úteis apresentam desvios positivos em relação a esta base, enquanto meses com menor concentração apresentam desvios negativos. O modelo quantifica esses desvios percentuais, permitindo análise preditiva e identificação de variações fora do intervalo estatisticamente esperado.
      </p>
    </section>

    <!-- Indexadores -->
    <section class="card">
      <div class="card-body" style="padding: 0;">
        <div class="indexador-section">
          <div class="indexador-title">
            Indexadores de Valor de Consulta
          </div>
          <div class="indexador-subtitle">
            Valores globais aplicados a todas as especialidades. Alterações recalculam toda a análise preditiva.
          </div>
          <div class="indexador-grid">
            <div class="indexador-field">
              <div class="indexador-label">Consulta Tradicional <span style="opacity: 0.5; font-size: 10px;">(Rₜ)</span></div>
              <div class="indexador-input-wrapper">
                <span class="indexador-prefix">R$</span>
                <input type="number" class="indexador-input" id="valorTradicional" step="0.01" value="48.50">
              </div>
              <div class="indexador-hint">Plantões diurnos em dias úteis sem feriado</div>
            </div>
            <div class="indexador-field">
              <div class="indexador-label">Consulta Especial <span style="opacity: 0.5; font-size: 10px;">(Rₑ)</span></div>
              <div class="indexador-input-wrapper">
                <span class="indexador-prefix">R$</span>
                <input type="number" class="indexador-input" id="valorEspecial" step="0.01" value="63.05">
              </div>
              <div class="indexador-hint">Plantões noturnos, finais de semana e feriados</div>
            </div>
          </div>
          <div class="indexador-actions">
            <button class="btn-light" id="btnResetIndexadores">
              Restaurar Valores Padrão
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Seletor de Período -->
    <section class="card">
      <div class="card-body" style="padding: 0;">
        <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); padding: 28px; border-radius: 0;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <div style="font-size: 18px; font-weight: 800; color: var(--text-primary); margin-bottom: 4px;">
                Período de Análise
              </div>
              <div style="font-size: 13px; color: var(--text-secondary);">
                Selecione o intervalo de meses para análise preditiva
              </div>
            </div>
          </div>
          
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            <div class="indexador-field" style="background: rgba(255, 255, 255, 0.9); border-color: rgba(25, 99, 150, 0.2);">
              <div class="indexador-label" style="color: var(--text-primary);">Mês Inicial</div>
              <select class="indexador-input" id="mesInicial" style="color: var(--text-primary); cursor: pointer; padding-right: 36px; background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'12\' height=\'12\' viewBox=\'0 0 12 12\'%3E%3Cpath fill=\'%23475569\' d=\'M6 9L1 4h10z\'/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 12px center;">
                <option value="2025-01">Janeiro/2025</option>
                <option value="2025-02">Fevereiro/2025</option>
                <option value="2025-03">Março/2025</option>
                <option value="2025-04">Abril/2025</option>
                <option value="2025-05">Maio/2025</option>
                <option value="2025-06">Junho/2025</option>
                <option value="2025-07">Julho/2025</option>
                <option value="2025-08">Agosto/2025</option>
                <option value="2025-09" selected>Setembro/2025</option>
                <option value="2025-10">Outubro/2025</option>
                <option value="2025-11">Novembro/2025</option>
                <option value="2025-12">Dezembro/2025</option>
                <option value="2026-01">Janeiro/2026</option>
                <option value="2026-02">Fevereiro/2026</option>
                <option value="2026-03">Março/2026</option>
                <option value="2026-04">Abril/2026</option>
                <option value="2026-05">Maio/2026</option>
                <option value="2026-06">Junho/2026</option>
                <option value="2026-07">Julho/2026</option>
                <option value="2026-08">Agosto/2026</option>
                <option value="2026-09">Setembro/2026</option>
                <option value="2026-10">Outubro/2026</option>
                <option value="2026-11">Novembro/2026</option>
                <option value="2026-12">Dezembro/2026</option>
              </select>
            </div>

            <div class="indexador-field" style="background: rgba(255, 255, 255, 0.9); border-color: rgba(25, 99, 150, 0.2);">
              <div class="indexador-label" style="color: var(--text-primary);">Mês Final</div>
              <select class="indexador-input" id="mesFinal" style="color: var(--text-primary); cursor: pointer; padding-right: 36px; background-image: url('data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'12\' height=\'12\' viewBox=\'0 0 12 12\'%3E%3Cpath fill=\'%23475569\' d=\'M6 9L1 4h10z\'/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 12px center;">
                <option value="2025-01">Janeiro/2025</option>
                <option value="2025-02">Fevereiro/2025</option>
                <option value="2025-03">Março/2025</option>
                <option value="2025-04">Abril/2025</option>
                <option value="2025-05">Maio/2025</option>
                <option value="2025-06">Junho/2025</option>
                <option value="2025-07">Julho/2025</option>
                <option value="2025-08">Agosto/2025</option>
                <option value="2025-09">Setembro/2025</option>
                <option value="2025-10">Outubro/2025</option>
                <option value="2025-11">Novembro/2025</option>
                <option value="2025-12">Dezembro/2025</option>
                <option value="2026-01">Janeiro/2026</option>
                <option value="2026-02">Fevereiro/2026</option>
                <option value="2026-03">Março/2026</option>
                <option value="2026-04">Abril/2026</option>
                <option value="2026-05">Maio/2026</option>
                <option value="2026-06">Junho/2026</option>
                <option value="2026-07">Julho/2026</option>
                <option value="2026-08">Agosto/2026</option>
                <option value="2026-09">Setembro/2026</option>
                <option value="2026-10">Outubro/2026</option>
                <option value="2026-11">Novembro/2026</option>
                <option value="2026-12" selected>Dezembro/2026</option>
              </select>
            </div>

            <div class="indexador-field" style="background: rgba(255, 255, 255, 0.95); border: 2px solid var(--ax-primary);">
              <div class="indexador-label" style="color: var(--text-primary);">Total de Meses</div>
              <div style="font-size: 32px; font-weight: 900; color: var(--ax-primary); text-align: center; padding: 8px 0;" id="totalMeses">
                16
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Especialidades -->
    <section class="card">
      <div class="card-header">
        <h2 class="card-title">Configuração de Especialidades Médicas</h2>
        <button class="btn btn-secondary" id="btnReset">
          Limpar Configurações
        </button>
      </div>
      <div class="card-body">
        <div style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); padding: 20px; border-radius: 12px; margin-bottom: 24px; border-left: 4px solid var(--ax-primary);">
          <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 12px; line-height: 1.6;">
            Selecione abaixo as especialidades parametrizadas para sua instituição.
          </p>
          <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
            <span style="font-size: 14px; font-weight: 600; color: var(--text-primary);">
              Quer simular uma nova possibilidade de plantão?
            </span>
            <button class="btn btn-primary btn-simulator" id="btnAbrirSimulador" style="padding: 10px 20px; font-size: 13px;">
              ✨ Abrir Simulador
            </button>
          </div>
        </div>
        <div class="especialidades-grid" id="especialidadesGrid">
          <!-- Gerado dinamicamente -->
        </div>
      </div>
    </section>

    <!-- Análise Estatística -->
    <section class="card">
      <div class="card-header">
        <h2 class="card-title">Análise Estatística de Variabilidade</h2>
      </div>
      <div class="card-body">
        <div class="stats-grid" id="statsGrid">
          <!-- Gerado dinamicamente -->
        </div>
      </div>
    </section>

    <!-- Análise Detalhada -->
    <section class="card">
      <div class="tabs" role="tablist">
        <button class="tab active" role="tab" data-tab="mensal" aria-selected="true">
          Série Mensal Detalhada
        </button>
        <button class="tab tab-chart" role="tab" data-tab="grafico" aria-selected="false">
          Visualização Gráfica
        </button>
      </div>

      <div class="tab-content active" id="tabMensal">
        <div class="card-body">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Mês</th>
                  <th class="numeric">Dias</th>
                  <th class="numeric">Úteis (W)</th>
                  <th class="numeric">Fins-Sem. (S)</th>
                  <th class="numeric">Fer. Úteis (H)</th>
                  <th class="numeric">Valor Esp. 1</th>
                  <th class="numeric">Var. %</th>
                  <th class="numeric">Valor Esp. 2</th>
                  <th class="numeric">Var. %</th>
                  <th class="numeric">Valor Esp. 3</th>
                  <th class="numeric">Var. %</th>
                  <th class="numeric">Valor Esp. 4</th>
                  <th class="numeric">Var. %</th>
                  <th>Feriados</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="tab-content" id="tabGrafico">
        <div class="card-body">
          <div class="chart-container">
            <canvas id="mainChart"></canvas>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <img class="footer-logo" src="https://i.imgur.com/yAUQciP.png" alt="AxiaCare Logo">
    <div class="footer-title">AxView™ | WebApps - Gestão e Consultoria em Saúde</div>
    <div class="footer-links">
      <a href="https://linktr.ee/gui.thome">Conheça nossas soluções.</a>
      <span class="separator">|</span>
      <a href="https://www.axcare.com.br">axcare.com.br</a>
      <span class="separator">|</span>
      <a href="https://www.medvalor.med.br">medvalor.med.br</a>
    </div>
    <div class="footer-social">
      <a href="https://guithome.com.br">guithome.com.br</a>
      <span class="separator">|</span>
      <a href="https://linkedin.com/in/guithome">LinkedIn</a>
      <span class="separator">|</span>
      <a href="https://www.instagram.com/gui.thome/">Instagram</a>
    </div>
    <div class="footer-copyright">
      Copyright © 2025 AxiaCare | Todos os direitos reservados | Uma empresa do Grupo CSV
    </div>
  </footer>

  <script>
    const ESPECIALIDADES_DISPONIVEIS = [
      { nome: 'ANESTESIOLOGIA (PLANTÃO)', consultas: 20, tipo: 'plantao' },
      { nome: 'ANESTESIOLOGIA (SOBREAVISO)', consultas: 6, tipo: 'sobreaviso' },
      { nome: 'ANESTESIOLOGIA (TOTAL)', consultas: 20, tipo: 'total_anestesio', combo: true },
      { nome: 'CIRURGIA GERAL (PLANTÃO)', consultas: 20, tipo: 'plantao' },
      { nome: 'CIRURGIA GERAL (CINDERELA)', consultas: 4, tipo: 'cinderela' },
      { nome: 'CIRURGIA GERAL (TOTAL)', consultas: 20, tipo: 'total_cirurgia', combo: true },
      { nome: 'CLÍNICA MÉDICA', consultas: 25, tipo: 'plantao' },
      { nome: 'GINECOLOGIA OBSTETRÍCIA', consultas: 20, tipo: 'plantao' },
      { nome: 'ORTOPEDIA', consultas: 20, tipo: 'plantao' },
      { nome: 'PEDIATRIA PSI', consultas: 32, tipo: 'plantao' },
      { nome: 'PEDIATRIA SOCORRISTA', consultas: 37.5, tipo: 'plantao' },
      { nome: 'PEDIATRIA UIEP', consultas: 37.5, tipo: 'plantao' },
      { nome: 'SOCORRISTA ADULTO', consultas: 37.5, tipo: 'plantao' },
      { nome: 'TERAPIA INTENSIVA ADULTO', consultas: 37.5, tipo: 'plantao' },
      { nome: 'OUTRA', consultas: 0, tipo: 'custom' }
    ];

    const CORES_ESPECIALIDADES = [
      { color: '#196396', colorDark: '#0f4764' },
      { color: '#10b981', colorDark: '#065f46' },
      { color: '#ff8f00', colorDark: '#c56000' },
      { color: '#8b5cf6', colorDark: '#6d28d9' }
    ];

    const BRL = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
    const NUM = new Intl.NumberFormat('pt-BR', { maximumFractionDigits: 2, minimumFractionDigits: 2 });
    const pad2 = n => n < 10 ? `0${n}` : String(n);
    const ymd = d => `${d.getFullYear()}-${pad2(d.getMonth() + 1)}-${pad2(d.getDate())}`;
    const formatBRL = v => BRL.format(v);
    const formatNum = v => NUM.format(v);
    const formatPct = v => `${v > 0 ? '+' : ''}${formatNum(v)}%`;

    function showToast(message) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = 'toast success';
      toast.innerHTML = `<div class="toast-message">${message}</div>`;
      container.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Modal
    const modal = document.getElementById('infoModal');
    const openModal = document.getElementById('openModal');
    const closeModal = document.getElementById('closeModal');

    openModal.addEventListener('click', () => {
      modal.classList.add('active');
    });

    closeModal.addEventListener('click', () => {
      modal.classList.remove('active');
    });

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.remove('active');
      }
    });

    // Modal Simulador
    const simuladorModal = document.getElementById('simuladorModal');
    const openSimulador = document.getElementById('btnAbrirSimulador');
    const closeSimulador = document.getElementById('closeSimulador');

    openSimulador.addEventListener('click', () => {
      simuladorModal.classList.add('active');
      updateSimuladorOrcamento();
    });

    closeSimulador.addEventListener('click', () => {
      simuladorModal.classList.remove('active');
    });

    simuladorModal.addEventListener('click', (e) => {
      if (e.target === simuladorModal) {
        simuladorModal.classList.remove('active');
      }
    });

    // Tema
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    
    function setTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      themeIcon.textContent = theme === 'dark' ? 'L' : 'D';
      localStorage.setItem('theme', theme);
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
      setTheme(currentTheme === 'dark' ? 'light' : 'dark');
    });

    const savedTheme = localStorage.getItem('theme') || 'light';
    setTheme(savedTheme);

    const hero = document.getElementById('hero');
    window.addEventListener('scroll', () => {
      hero.classList.toggle('scrolled', window.scrollY > 10);
    });

    // Feriados
    function easterSunday(year) {
      const a = year % 19;
      const b = Math.floor(year / 100);
      const c = year % 100;
      const d = Math.floor(b / 4);
      const e = b % 4;
      const f = Math.floor((b + 8) / 25);
      const g = Math.floor((b - f + 1) / 3);
      const h = (19 * a + b - d - g + 15) % 30;
      const i = Math.floor(c / 4);
      const k = c % 4;
      const l = (32 + 2 * e + 2 * i - h - k) % 7;
      const m = Math.floor((a + 11 * h + 22 * l) / 451);
      const month = Math.floor((h + l - 7 * m + 114) / 31);
      const day = ((h + l - 7 * m + 114) % 31) + 1;
      return new Date(year, month - 1, day);
    }

    const addDays = (date, days) => {
      const result = new Date(date);
      result.setDate(result.getDate() + days);
      return result;
    };

    const FIXED_HOLIDAYS = ['01-01', '04-21', '05-01', '09-07', '10-12', '11-02', '11-15', '11-20', '12-25'];

    function getHolidays(year) {
      const holidays = new Set(FIXED_HOLIDAYS.map(md => `${year}-${md}`));
      const goodFriday = addDays(easterSunday(year), -2);
      holidays.add(ymd(goodFriday));
      return holidays;
    }

    function getMonthDays(year, month) {
      const days = [];
      const date = new Date(year, month, 1);
      while (date.getMonth() === month) {
        days.push(new Date(date));
        date.setDate(date.getDate() + 1);
      }
      return days;
    }

    function analyzeMonth(year, month, holidays) {
      const days = getMonthDays(year, month);
      let weekends = 0;
      let weekdays = 0;
      let holidaysWeekdays = 0;
      const holidayDates = [];

      for (const day of days) {
        const dow = day.getDay();
        const isWeekend = dow === 0 || dow === 6;
        
        if (isWeekend) {
          weekends++;
        } else {
          weekdays++;
          if (holidays.has(ymd(day))) {
            holidaysWeekdays++;
            holidayDates.push(day);
          }
        }
      }

      return {
        total: days.length,
        weekends,
        weekdays,
        holidaysWeekdays,
        holidayDates
      };
    }

    function generateMonthsSeries(mesInicial, mesFinal) {
      const months = [];
      const [anoIni, mesIni] = mesInicial.split('-').map(Number);
      const [anoFim, mesFim] = mesFinal.split('-').map(Number);
      
      const holidays2025 = getHolidays(2025);
      const holidays2026 = getHolidays(2026);
      const holidays2027 = getHolidays(2027);

      let currentYear = anoIni;
      let currentMonth = mesIni - 1; // JavaScript months são 0-indexed

      while (currentYear < anoFim || (currentYear === anoFim && currentMonth <= mesFim - 1)) {
        const holidays = currentYear === 2025 ? holidays2025 : currentYear === 2026 ? holidays2026 : holidays2027;
        const data = analyzeMonth(currentYear, currentMonth, holidays);
        
        months.push({
          year: currentYear,
          month: currentMonth + 1,
          label: `${pad2(currentMonth + 1)}/${String(currentYear).slice(2)}`,
          ...data
        });

        currentMonth++;
        if (currentMonth > 11) {
          currentMonth = 0;
          currentYear++;
        }
      }

      return months;
    }

    let MONTHS_DATA = generateMonthsSeries(appState.mesInicial, appState.mesFinal);

    function updateTotalMeses() {
      const totalMeses = MONTHS_DATA.length;
      document.getElementById('totalMeses').textContent = totalMeses;
      
      // Atualizar subtítulo
      const [anoIni] = appState.mesInicial.split('-');
      const [anoFim] = appState.mesFinal.split('-');
      
      if (anoIni === anoFim) {
        document.querySelector('.hero-subtitle').textContent = `Análise Preditiva Orçamentária | ${anoIni}`;
      } else {
        document.querySelector('.hero-subtitle').textContent = `Análise Preditiva Orçamentária | ${anoIni} - ${anoFim}`;
      }
    }

    const appState = {
      valorTradicional: 48.50,
      valorEspecial: 63.05,
      mesInicial: '2025-09',
      mesFinal: '2026-12',
      especialidades: [
        { id: 1, nome: '', nomeCustom: '', consultasPorPlantao: 0, tipo: 'plantao', ativa: false, ...CORES_ESPECIALIDADES[0] },
        { id: 2, nome: '', nomeCustom: '', consultasPorPlantao: 0, tipo: 'plantao', ativa: false, ...CORES_ESPECIALIDADES[1] },
        { id: 3, nome: '', nomeCustom: '', consultasPorPlantao: 0, tipo: 'plantao', ativa: false, ...CORES_ESPECIALIDADES[2] },
        { id: 4, nome: '', nomeCustom: '', consultasPorPlantao: 0, tipo: 'plantao', ativa: false, ...CORES_ESPECIALIDADES[3] }
      ],
      simulador: {
        nome: '',
        medicos: 1,
        consultasTrad: 0,
        consultasEsp: 0
      }
    };

    function updateSimuladorOrcamento() {
      const medicos = parseInt(document.getElementById('simMedicos').value) || 1;
      const trad = parseFloat(document.getElementById('simTrad').value) || 0;
      const esp = parseFloat(document.getElementById('simEsp').value) || 0;
      
      const orcamentoBase = medicos * (trad * appState.valorTradicional + esp * appState.valorEspecial);
      document.getElementById('simOrcamentoBase').textContent = formatBRL(orcamentoBase);
    }

    function saveData() {
      localStorage.setItem('appState', JSON.stringify(appState));
    }

    function loadData() {
      const saved = localStorage.getItem('appState');
      if (saved) {
        try {
          const data = JSON.parse(saved);
          appState.valorTradicional = data.valorTradicional || 48.50;
          appState.valorEspecial = data.valorEspecial || 63.05;
          appState.mesInicial = data.mesInicial || '2025-09';
          appState.mesFinal = data.mesFinal || '2026-12';
          
          document.getElementById('valorTradicional').value = appState.valorTradicional;
          document.getElementById('valorEspecial').value = appState.valorEspecial;
          document.getElementById('mesInicial').value = appState.mesInicial;
          document.getElementById('mesFinal').value = appState.mesFinal;
          
          // Regenerar MONTHS_DATA com período salvo
          MONTHS_DATA = generateMonthsSeries(appState.mesInicial, appState.mesFinal);
          updateTotalMeses();
          
          if (data.especialidades) {
            data.especialidades.forEach((esp, i) => {
              if (appState.especialidades[i]) {
                appState.especialidades[i].nome = esp.nome || '';
                appState.especialidades[i].nomeCustom = esp.nomeCustom || '';
                appState.especialidades[i].consultasPorPlantao = esp.consultasPorPlantao || 0;
                appState.especialidades[i].tipo = esp.tipo || 'plantao';
                appState.especialidades[i].simulado = esp.simulado || null;
                appState.especialidades[i].ativa = esp.ativa || false;
              }
            });
          }
          if (data.simulador) {
            appState.simulador = data.simulador;
            document.getElementById('simNome').value = data.simulador.nome || '';
            document.getElementById('simMedicos').value = data.simulador.medicos || 1;
            document.getElementById('simTrad').value = data.simulador.consultasTrad || 0;
            document.getElementById('simEsp').value = data.simulador.consultasEsp || 0;
          }
          
          document.getElementById('valorTradicional').value = appState.valorTradicional;
          document.getElementById('valorEspecial').value = appState.valorEspecial;
          
          showToast('Configurações carregadas');
        } catch (e) {
          console.error('Erro ao carregar dados:', e);
        }
      }
    }

    function renderEspecialidades() {
      const grid = document.getElementById('especialidadesGrid');
      grid.innerHTML = '';

      appState.especialidades.forEach((esp, index) => {
        const card = document.createElement('div');
        card.className = 'esp-card';
        card.style.setProperty('--esp-color', esp.color);
        card.style.setProperty('--esp-color-dark', esp.colorDark);

        // Cálculo do orçamento base
        let budgetBase = 0;
        if (esp.tipo === 'total_anestesio') {
          const budgetPlantao = 20 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
          const budgetSobreaviso = budgetPlantao * 0.3; // 30% do plantão de 20
          budgetBase = budgetPlantao + budgetSobreaviso;
        } else if (esp.tipo === 'total_cirurgia') {
          const budgetPlantao = 20 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
          const budgetCinderela = 4 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
          budgetBase = budgetPlantao + budgetCinderela * (4/12) + budgetCinderela * (8/12) * 0.3;
        } else if (esp.tipo === 'sobreaviso') {
          const budgetPlantaoRef = 20 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
          budgetBase = budgetPlantaoRef * 0.3;
        } else if (esp.tipo === 'cinderela') {
          const plantaoPresencial = esp.consultasPorPlantao * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
          const sobreaviso = plantaoPresencial * (8/12) * 0.3;
          budgetBase = plantaoPresencial * (4/12) + sobreaviso;
        } else if (esp.tipo === 'simulado' && esp.simulado) {
          const { medicos, trad, esp: espConsultas } = esp.simulado;
          budgetBase = medicos * (trad * 22 * appState.valorTradicional + espConsultas * 38 * appState.valorEspecial);
        } else {
          budgetBase = esp.consultasPorPlantao * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
        }

        const options = ['<option value="">Selecione uma especialidade</option>'];
        ESPECIALIDADES_DISPONIVEIS.forEach(item => {
          options.push(`<option value="${item.nome}" ${esp.nome === item.nome ? 'selected' : ''}>${item.nome}</option>`);
        });

        const isCustom = esp.nome === 'OUTRA';
        const displayName = isCustom && esp.nomeCustom ? esp.nomeCustom : (esp.nome || 'Não configurada');

        let tipoLabel = '';
        if (esp.tipo === 'sobreaviso') tipoLabel = ' (30% do plantão)';
        if (esp.tipo === 'cinderela') tipoLabel = ' (4h presencial + 8h sobreaviso)';

        card.innerHTML = `
          <div class="esp-header">
            <div class="esp-title">
              <span class="esp-badge">${esp.id}</span>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" ${esp.ativa ? 'checked' : ''} data-esp="${index}">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="esp-fields">
            <div class="field-group">
              <label class="field-label">Especialidade Médica</label>
              <select class="input-field" data-esp="${index}" data-field="nome">
                ${options.join('')}
              </select>
              <span class="field-hint">Selecione a especialidade (valores são exemplos ajustáveis)</span>
            </div>
            <div class="field-group custom-name-field ${isCustom ? 'active' : ''}" id="customName${index}">
              <label class="field-label">Nome da Especialidade</label>
              <input type="text" class="input-field" data-esp="${index}" data-field="nomeCustom" value="${esp.nomeCustom}" placeholder="Digite o nome da especialidade">
            </div>
            <div class="field-group">
              <label class="field-label">Consultas por Plantão (12h) <span style="opacity: 0.5; font-size: 11px; font-weight: 500;">Indexador</span></label>
              <div class="number-control">
                <button class="number-btn" data-esp="${index}" data-action="decrease">−</button>
                <input type="number" class="number-input" step="0.5" min="0" value="${esp.consultasPorPlantao}" data-esp="${index}" data-field="consultasPorPlantao">
                <button class="number-btn" data-esp="${index}" data-action="increase">+</button>
              </div>
              <span class="field-hint">Ajuste o número médio de consultas</span>
            </div>
            <div class="budget-display">
              <div class="budget-label">Orçamento Base Mensal</div>
              <div class="budget-value">${formatBRL(budgetBase)}</div>
              <div class="budget-detail" style="font-size: 10px; opacity: 0.8; margin-top: 4px;">Considerando mês com 22 dias úteis e 8 dias de final de semana, sem feriados</div>
            </div>
          </div>
        `;

        grid.appendChild(card);
      });

      // Event listeners
      grid.querySelectorAll('input[type="checkbox"]').forEach(input => {
        input.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.esp);
          appState.especialidades[index].ativa = e.target.checked;
          saveData();
          renderAll();
        });
      });

      grid.querySelectorAll('select').forEach(input => {
        input.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.esp);
          const selectedName = e.target.value;
          
          appState.especialidades[index].nome = selectedName;
          
          const espConfig = ESPECIALIDADES_DISPONIVEIS.find(item => item.nome === selectedName);
          if (espConfig) {
            appState.especialidades[index].consultasPorPlantao = espConfig.consultas;
            appState.especialidades[index].tipo = espConfig.tipo;
          }

          const customField = document.getElementById(`customName${index}`);
          if (selectedName === 'OUTRA') {
            customField.classList.add('active');
          } else {
            customField.classList.remove('active');
            appState.especialidades[index].nomeCustom = '';
          }

          saveData();
          renderAll();
        });
      });

      grid.querySelectorAll('input[type="text"]').forEach(input => {
        input.addEventListener('input', (e) => {
          const index = parseInt(e.target.dataset.esp);
          appState.especialidades[index].nomeCustom = e.target.value;
          saveData();
          renderAll();
        });
      });

      grid.querySelectorAll('input[type="number"]').forEach(input => {
        input.addEventListener('change', (e) => {
          const index = parseInt(e.target.dataset.esp);
          appState.especialidades[index].consultasPorPlantao = parseFloat(e.target.value) || 0;
          saveData();
          renderAll();
        });
      });

      grid.querySelectorAll('.number-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const index = parseInt(e.target.dataset.esp);
          const action = e.target.dataset.action;
          const currentValue = appState.especialidades[index].consultasPorPlantao;
          
          if (action === 'increase') {
            appState.especialidades[index].consultasPorPlantao = currentValue + 0.5;
          } else if (action === 'decrease' && currentValue > 0) {
            appState.especialidades[index].consultasPorPlantao = Math.max(0, currentValue - 0.5);
          }
          
          saveData();
          renderAll();
        });
      });
    }

    document.getElementById('valorTradicional').addEventListener('input', (e) => {
      appState.valorTradicional = parseFloat(e.target.value) || 0;
      saveData();
      renderAll();
    });

    document.getElementById('valorEspecial').addEventListener('input', (e) => {
      appState.valorEspecial = parseFloat(e.target.value) || 0;
      saveData();
      renderAll();
    });

    document.getElementById('mesInicial').addEventListener('change', (e) => {
      const novoInicial = e.target.value;
      const mesFinalAtual = document.getElementById('mesFinal').value;
      
      // Validar que mesInicial não seja posterior a mesFinal
      if (novoInicial > mesFinalAtual) {
        alert('O mês inicial não pode ser posterior ao mês final. Ajustando mês final automaticamente.');
        appState.mesFinal = novoInicial;
        document.getElementById('mesFinal').value = novoInicial;
      }
      
      appState.mesInicial = novoInicial;
      MONTHS_DATA = generateMonthsSeries(appState.mesInicial, appState.mesFinal);
      updateTotalMeses();
      saveData();
      renderAll();
      showToast('Período atualizado');
    });

    document.getElementById('mesFinal').addEventListener('change', (e) => {
      const novoFinal = e.target.value;
      const mesInicialAtual = document.getElementById('mesInicial').value;
      
      // Validar que mesFinal não seja anterior a mesInicial
      if (novoFinal < mesInicialAtual) {
        alert('O mês final não pode ser anterior ao mês inicial. Ajustando mês inicial automaticamente.');
        appState.mesInicial = novoFinal;
        document.getElementById('mesInicial').value = novoFinal;
      }
      
      appState.mesFinal = novoFinal;
      MONTHS_DATA = generateMonthsSeries(appState.mesInicial, appState.mesFinal);
      updateTotalMeses();
      saveData();
      renderAll();
      showToast('Período atualizado');
    });

    document.getElementById('btnResetIndexadores').addEventListener('click', () => {
      appState.valorTradicional = 48.50;
      appState.valorEspecial = 63.05;
      document.getElementById('valorTradicional').value = 48.50;
      document.getElementById('valorEspecial').value = 63.05;
      saveData();
      renderAll();
      showToast('Indexadores restaurados');
    });

    function calculateData() {
      return MONTHS_DATA.map(month => {
        const conventional = month.weekdays - month.holidaysWeekdays;
        const special = month.total + month.weekends + month.holidaysWeekdays;

        const results = appState.especialidades.map(esp => {
          if (!esp.ativa || esp.consultasPorPlantao <= 0 || (!esp.nome || (esp.nome === 'OUTRA' && !esp.nomeCustom))) {
            return { value: 0, variance: 0 };
          }

          let value = 0;
          let budget = 0;

          if (esp.tipo === 'total_anestesio') {
            // ANESTESIOLOGIA TOTAL = Plantão (20 consultas) + Sobreaviso (6 consultas = 30% do plantão de 20)
            const plantao = 20 * (conventional * appState.valorTradicional + special * appState.valorEspecial);
            const valorPlantao20 = 20 * (conventional * appState.valorTradicional + special * appState.valorEspecial);
            const sobreaviso = valorPlantao20 * 0.3; // 30% do plantão de 20 consultas
            value = plantao + sobreaviso;
            
            const budgetPlantao = 20 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
            const budgetSobreaviso = budgetPlantao * 0.3; // 30% do plantão de 20
            budget = budgetPlantao + budgetSobreaviso;
          } else if (esp.tipo === 'total_cirurgia') {
            // CIRURGIA GERAL TOTAL = Plantão (20) + Cinderela (4h presencial + 8h sobreaviso)
            const plantao = 20 * (conventional * appState.valorTradicional + special * appState.valorEspecial);
            const cinderelaPresencial = 4 * (conventional * appState.valorTradicional + special * appState.valorEspecial);
            const cinderelaSobreaviso = 4 * (conventional * appState.valorTradicional + special * appState.valorEspecial) * (8/12) * 0.3;
            value = plantao + cinderelaPresencial * (4/12) + cinderelaSobreaviso;
            
            const budgetPlantao = 20 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
            const budgetCinderela = 4 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
            budget = budgetPlantao + budgetCinderela * (4/12) + budgetCinderela * (8/12) * 0.3;
          } else if (esp.tipo === 'sobreaviso') {
            // Sobreaviso: as 6 consultas equivalem a 30% do plantão de 20 consultas
            // Proporção: 6/20 = 0.3, logo valor = (plantão de referência) * 0.3
            const plantaoReferencia = 20 * (conventional * appState.valorTradicional + special * appState.valorEspecial);
            value = plantaoReferencia * 0.3;
            
            const budgetPlantaoRef = 20 * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
            budget = budgetPlantaoRef * 0.3;
          } else if (esp.tipo === 'cinderela') {
            const plantaoPresencial = esp.consultasPorPlantao * (conventional * appState.valorTradicional + special * appState.valorEspecial);
            const sobreaviso = esp.consultasPorPlantao * (conventional * appState.valorTradicional + special * appState.valorEspecial) * (8/12) * 0.3;
            value = plantaoPresencial * (4/12) + sobreaviso;
            
            const budgetPresencial = esp.consultasPorPlantao * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
            budget = budgetPresencial * (4/12) + budgetPresencial * (8/12) * 0.3;
          } else if (esp.tipo === 'simulado' && esp.simulado) {
            // Plantão simulado com proporções customizadas
            const { medicos, trad, esp: espConsultas } = esp.simulado;
            value = medicos * (trad * conventional * appState.valorTradicional + espConsultas * special * appState.valorEspecial);
            budget = medicos * (trad * 22 * appState.valorTradicional + espConsultas * 38 * appState.valorEspecial);
          } else {
            value = esp.consultasPorPlantao * (conventional * appState.valorTradicional + special * appState.valorEspecial);
            budget = esp.consultasPorPlantao * (22 * appState.valorTradicional + 38 * appState.valorEspecial);
          }

          const variance = budget > 0 ? ((value / budget - 1) * 100) : 0;

          return { value, variance };
        });

        const holidaysStr = month.holidayDates
          .map(d => `${pad2(d.getDate())}/${pad2(d.getMonth() + 1)}`)
          .join(', ') || '';

        return {
          ...month,
          esp1: results[0],
          esp2: results[1],
          esp3: results[2],
          esp4: results[3],
          holidaysStr
        };
      });
    }

    function renderStats() {
      const data = calculateData();
      const grid = document.getElementById('statsGrid');
      
      const activeEsp = appState.especialidades.filter(e => {
        return e.ativa && e.consultasPorPlantao > 0 && e.nome && (e.nome !== 'OUTRA' || e.nomeCustom);
      });
      
      if (activeEsp.length === 0) {
        grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-tertiary);">Configure ao menos uma especialidade para visualizar a análise estatística.</p>';
        return;
      }

      const cards = [];

      activeEsp.forEach((esp, idx) => {
        const espKey = `esp${idx + 1}`;
        const data2026 = data.filter(d => d.year === 2026);
        const variances = data2026.map(d => d[espKey].variance).filter(v => v !== 0);
        
        if (variances.length > 0) {
          const maxVar = Math.max(...variances);
          const minVar = Math.min(...variances);
          const avgVar = variances.reduce((a, b) => a + b, 0) / variances.length;
          const stdDev = Math.sqrt(variances.reduce((sq, n) => sq + Math.pow(n - avgVar, 2), 0) / variances.length);
          
          const upperLimit = avgVar + (2 * stdDev);
          const lowerLimit = avgVar - (2 * stdDev);

          const displayName = esp.nome === 'OUTRA' ? esp.nomeCustom : esp.nome;

          cards.push(`
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-label">${displayName}</div>
                <div class="stat-period">2026</div>
              </div>
              <div class="stat-value">${formatPct(maxVar)}</div>
              <div class="stat-description">
                <strong>Variação máxima:</strong> ${formatPct(maxVar)}<br>
                <strong>Variação mínima:</strong> ${formatPct(minVar)}<br>
                <strong>Desvio padrão:</strong> ${formatNum(stdDev)}%
              </div>
              <div class="stat-alert">
                Alerta em variações acima de ${formatPct(upperLimit)} ou abaixo de ${formatPct(lowerLimit)}
              </div>
            </div>
          `);
        }
      });

      grid.innerHTML = cards.join('');
    }

    function renderTable() {
      const data = calculateData();
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';

      data.forEach(row => {
        const tr = document.createElement('tr');

        const esp1Class = row.esp1.variance > 0 ? 'value-positive' : row.esp1.variance < 0 ? 'value-negative' : 'value-neutral';
        const esp2Class = row.esp2.variance > 0 ? 'value-positive' : row.esp2.variance < 0 ? 'value-negative' : 'value-neutral';
        const esp3Class = row.esp3.variance > 0 ? 'value-positive' : row.esp3.variance < 0 ? 'value-negative' : 'value-neutral';
        const esp4Class = row.esp4.variance > 0 ? 'value-positive' : row.esp4.variance < 0 ? 'value-negative' : 'value-neutral';

        tr.innerHTML = `
          <td class="month-cell">${row.label}</td>
          <td class="numeric">${row.total}</td>
          <td class="numeric">${row.weekdays}</td>
          <td class="numeric">${row.weekends}</td>
          <td class="numeric">${row.holidaysWeekdays}</td>
          <td class="numeric">${row.esp1.value > 0 ? formatBRL(row.esp1.value) : ''}</td>
          <td class="numeric ${esp1Class}">${row.esp1.value > 0 ? formatPct(row.esp1.variance) : ''}</td>
          <td class="numeric">${row.esp2.value > 0 ? formatBRL(row.esp2.value) : ''}</td>
          <td class="numeric ${esp2Class}">${row.esp2.value > 0 ? formatPct(row.esp2.variance) : ''}</td>
          <td class="numeric">${row.esp3.value > 0 ? formatBRL(row.esp3.value) : ''}</td>
          <td class="numeric ${esp3Class}">${row.esp3.value > 0 ? formatPct(row.esp3.variance) : ''}</td>
          <td class="numeric">${row.esp4.value > 0 ? formatBRL(row.esp4.value) : ''}</td>
          <td class="numeric ${esp4Class}">${row.esp4.value > 0 ? formatPct(row.esp4.variance) : ''}</td>
          <td class="holidays-cell">${row.holidaysStr}</td>
        `;

        tbody.appendChild(tr);
      });
    }

    let mainChart = null;

    function renderMainChart() {
      const data = calculateData();
      const ctx = document.getElementById('mainChart').getContext('2d');
      
      const labels = data.map(d => d.label);
      
      const datasets = [];
      appState.especialidades.forEach((esp, i) => {
        if (esp.ativa && esp.consultasPorPlantao > 0 && esp.nome && (esp.nome !== 'OUTRA' || esp.nomeCustom)) {
          const values = data.map(d => d[`esp${i + 1}`].value || null);
          const displayName = esp.nome === 'OUTRA' ? esp.nomeCustom : esp.nome;
          
          datasets.push({
            label: displayName,
            data: values,
            borderColor: esp.color,
            backgroundColor: `${esp.color}20`,
            borderWidth: 3,
            tension: 0.4,
            fill: false,
            pointRadius: 5,
            pointHoverRadius: 8,
            pointBackgroundColor: esp.color,
            pointBorderColor: '#fff',
            pointBorderWidth: 2,
            pointHoverBackgroundColor: esp.color,
            pointHoverBorderColor: '#fff',
            pointHoverBorderWidth: 3
          });
        }
      });

      if (mainChart) {
        mainChart.destroy();
      }

      const isMobile = window.innerWidth < 768;

      mainChart = new Chart(ctx, {
        type: 'line',
        data: { labels, datasets },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: 'index',
            intersect: false
          },
          plugins: {
            legend: {
              position: isMobile ? 'bottom' : 'top',
              labels: {
                font: { 
                  size: isMobile ? 11 : 13, 
                  weight: 'bold',
                  family: 'Inter, sans-serif'
                },
                padding: isMobile ? 10 : 15,
                usePointStyle: true,
                boxWidth: isMobile ? 8 : 10,
                boxHeight: isMobile ? 8 : 10
              }
            },
            tooltip: {
              enabled: true,
              backgroundColor: 'rgba(0, 0, 0, 0.85)',
              titleColor: '#fff',
              bodyColor: '#fff',
              padding: isMobile ? 10 : 12,
              cornerRadius: 8,
              titleFont: { 
                size: isMobile ? 12 : 14, 
                weight: 'bold',
                family: 'Inter, sans-serif'
              },
              bodyFont: { 
                size: isMobile ? 11 : 13,
                family: 'Inter, sans-serif'
              },
              displayColors: true,
              callbacks: {
                label: (context) => ` ${context.dataset.label}: ${formatBRL(context.parsed.y)}`
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: (value) => {
                  if (isMobile && value >= 1000) {
                    return 'R$ ' + (value / 1000).toFixed(0) + 'k';
                  }
                  return formatBRL(value);
                },
                font: { 
                  size: isMobile ? 10 : 12,
                  family: 'Inter, sans-serif'
                },
                maxTicksLimit: isMobile ? 6 : 8
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.05)',
                drawBorder: false
              }
            },
            x: {
              ticks: {
                font: { 
                  size: isMobile ? 10 : 12,
                  family: 'Inter, sans-serif'
                },
                maxRotation: isMobile ? 45 : 0,
                minRotation: isMobile ? 45 : 0
              },
              grid: {
                display: false,
                drawBorder: false
              }
            }
          },
          layout: {
            padding: {
              top: 10,
              right: isMobile ? 5 : 10,
              bottom: 10,
              left: isMobile ? 5 : 10
            }
          }
        }
      });
    }

    function exportCSV() {
      const data = calculateData();
      
      const headers = ['Mês', 'Ano', 'Dias', 'Úteis', 'Fins-Semana', 'Feriados', 
                      'Valor Esp.1', 'Var% Esp.1', 'Valor Esp.2', 'Var% Esp.2', 
                      'Valor Esp.3', 'Var% Esp.3', 'Valor Esp.4', 'Var% Esp.4'];
      
      const rows = data.map(d => [
        d.month, d.year, d.total, d.weekdays, d.weekends, d.holidaysWeekdays,
        d.esp1.value.toFixed(2), d.esp1.variance.toFixed(2),
        d.esp2.value.toFixed(2), d.esp2.variance.toFixed(2),
        d.esp3.value.toFixed(2), d.esp3.variance.toFixed(2),
        d.esp4.value.toFixed(2), d.esp4.variance.toFixed(2)
      ]);

      const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
      
      const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `analise_preditiva_plantoes_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      URL.revokeObjectURL(url);

      showToast('CSV exportado');
    }

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
        });
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        tab.classList.add('active');
        tab.setAttribute('aria-selected', 'true');
        
        const tabId = tab.dataset.tab;
        document.getElementById(`tab${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`).classList.add('active');

        if (tabId === 'grafico') {
          setTimeout(() => renderMainChart(), 100);
        }
      });
    });

    document.getElementById('btnReset').addEventListener('click', () => {
      if (confirm('Limpar todas as especialidades configuradas?')) {
        appState.especialidades.forEach(esp => {
          esp.nome = '';
          esp.nomeCustom = '';
          esp.consultasPorPlantao = 0;
          esp.tipo = 'plantao';
          esp.ativa = false;
        });
        saveData();
        renderAll();
        showToast('Especialidades limpas');
      }
    });

    function renderAll() {
      renderEspecialidades();
      renderStats();
      renderTable();
      if (mainChart) renderMainChart();
    }

    loadData();
    updateTotalMeses();
    renderAll();

    // Simulador event listeners
    document.getElementById('simNome').addEventListener('input', (e) => {
      appState.simulador.nome = e.target.value;
      saveData();
    });

    ['simMedicos', 'simTrad', 'simEsp'].forEach(id => {
      document.getElementById(id).addEventListener('input', updateSimuladorOrcamento);
    });

    document.querySelectorAll('[data-sim]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const field = e.target.dataset.sim;
        const action = e.target.dataset.action;
        let input, step;

        if (field === 'medicos') {
          input = document.getElementById('simMedicos');
          step = 1;
        } else if (field === 'trad') {
          input = document.getElementById('simTrad');
          step = 0.5;
        } else if (field === 'esp') {
          input = document.getElementById('simEsp');
          step = 0.5;
        }

        let currentValue = parseFloat(input.value) || (field === 'medicos' ? 1 : 0);
        
        if (action === 'increase') {
          input.value = currentValue + step;
        } else if (action === 'decrease') {
          input.value = Math.max(field === 'medicos' ? 1 : 0, currentValue - step);
        }

        updateSimuladorOrcamento();
      });
    });

    document.getElementById('btnResetSimulador').addEventListener('click', () => {
      document.getElementById('simNome').value = '';
      document.getElementById('simMedicos').value = 1;
      document.getElementById('simTrad').value = 0;
      document.getElementById('simEsp').value = 0;
      appState.simulador = { nome: '', medicos: 1, consultasTrad: 0, consultasEsp: 0 };
      updateSimuladorOrcamento();
      saveData();
      showToast('Simulador limpo');
    });

    document.getElementById('btnAplicarSimulador').addEventListener('click', () => {
      const nome = document.getElementById('simNome').value;
      const medicos = parseInt(document.getElementById('simMedicos').value) || 1;
      const trad = parseFloat(document.getElementById('simTrad').value) || 0;
      const esp = parseFloat(document.getElementById('simEsp').value) || 0;

      if (!nome) {
        alert('Por favor, dê um nome ao plantão simulado');
        return;
      }

      if (trad === 0 && esp === 0) {
        alert('Configure ao menos um tipo de consulta (tradicional ou especial)');
        return;
      }

      // Aplicar ao Slot 1
      appState.especialidades[0].nome = 'OUTRA';
      appState.especialidades[0].nomeCustom = `${nome} (${medicos} ${medicos > 1 ? 'médicos' : 'médico'})`;
      appState.especialidades[0].consultasPorPlantao = medicos * (trad + esp);
      appState.especialidades[0].tipo = 'simulado';
      appState.especialidades[0].simulado = { medicos, trad, esp };
      appState.especialidades[0].ativa = true;

      saveData();
      renderAll();
      
      // Fechar modal
      simuladorModal.classList.remove('active');
      
      showToast('Plantão simulado aplicado ao Slot 1');
      
      // Scroll para as especialidades
      setTimeout(() => {
        document.querySelector('.especialidades-grid').scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
    });

    updateSimuladorOrcamento();

    setInterval(saveData, 30000);

    // Recriar gráfico ao redimensionar (importante para mobile/rotação)
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        if (mainChart && document.querySelector('.tab[data-tab="grafico"]').classList.contains('active')) {
          renderMainChart();
        }
      }, 250);
    });

    console.log('Sistema AxView inicializado');
  </script>
</body>
</html>
