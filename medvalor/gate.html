<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MedValor | Acesso a Conteúdos</title>
  <meta name="description" content="Informe seu e‑mail e abriremos automaticamente o conteúdo solicitado. Gate padrão, replicável e responsivo da MedValor." />
  <style>
    :root{
      /* Paleta institucional */
      --brand:#196396;   /* azul MedValor */
      --mint:#a6d8c0;    /* menta suave */
      --green:#a6fb90;   /* verde claro */
      --ink:#2d3445;     /* texto escuro */
      --bg:#f8f5f0;      /* fundo off‑white */
      --paper:#ffffff;   /* cartões */
      --muted:#5e6a7c;   /* texto secundário */
      --danger:#c0392b;  /* erro */
      --ok:#2f8f4e;      /* sucesso */
      --radius:18px;
      --shadow:0 18px 50px rgba(45,52,69,.15);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--ink); font:16px/1.55 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial}
    a{color:var(--brand)}

    .page-wrap{min-height:100vh; display:flex; align-items:center; justify-content:center; padding:56px 24px; transition: filter .2s ease, opacity .2s ease}
    .page-wrap.blurred{ filter: blur(6px); pointer-events:none; user-select:none; opacity:.7 }

    .hero{max-width:960px; width:100%; display:grid; grid-template-columns:1.1fr 1fr; gap:32px; align-items:center}
    @media (max-width: 900px){ .hero{ grid-template-columns:1fr } }

    .card{ background:var(--paper); border:1px solid rgba(25,99,150,.10); border-radius:var(--radius); box-shadow:var(--shadow); padding:28px }
    .badge{ display:inline-flex; gap:8px; align-items:center; font-size:12px; letter-spacing:.3px; text-transform:uppercase; color:var(--brand); background:rgba(25,99,150,.08); border:1px solid rgba(25,99,150,.18); padding:6px 10px; border-radius:999px }
    h1{ font-size: clamp(24px, 3.4vw, 40px); line-height:1.15; margin:12px 0 10px; color:var(--brand) }
    p.lead{ font-size: clamp(15px, 1.8vw, 18px); color: var(--muted); margin:0 0 10px }
    ul{ margin:10px 0 0 20px; color:var(--muted) }

    .illus{ background: linear-gradient(180deg, rgba(166,216,192,.35), rgba(166,251,144,.25)); border:1px dashed rgba(25,99,150,.25); border-radius:var(--radius); padding:24px }

    /* Overlay + modal */
    .overlay{ position:fixed; inset:0; background:rgba(25,99,150,.25); backdrop-filter: blur(2px); -webkit-backdrop-filter: blur(2px); opacity:0; pointer-events:none; transition:opacity .2s ease }
    .overlay.show{ opacity:1; pointer-events:auto }

    .modal{ position:fixed; inset:0; display:grid; place-items:center; padding:24px; opacity:0; transform: translateY(16px) scale(.98); transition: transform .2s ease, opacity .2s ease }
    .modal.show{ opacity:1; transform: translateY(0) scale(1) }
    .modal .panel{ width:min(560px,96vw); background:var(--paper); border:1px solid rgba(25,99,150,.15); border-radius:var(--radius); box-shadow:var(--shadow); padding:28px }
    .modal h2{ margin:0 0 6px; font-size:22px; color:var(--ink) }
    .modal p{ margin:0 0 14px; color:var(--muted) }

    .row{ display:flex; gap:10px }
    @media (max-width:520px){ .row{ flex-direction:column } }
    input[type="email"]{ flex:1; padding:14px 16px; border-radius:12px; border:1px solid rgba(25,99,150,.25); background:#fcfdff; color:var(--ink); outline:none; font-size:16px }
    input::placeholder{ color:#99a4b3 }

    button{ cursor:pointer; padding:14px 16px; border-radius:12px; border:0; font-weight:700; font-size:16px; color:white; background:var(--brand); box-shadow:0 10px 20px rgba(25,99,150,.15) }
    button:hover{ filter:brightness(.95) }
    button[disabled]{ opacity:.6; cursor:not-allowed }

    .msg{ font-size:13px; min-height:18px; margin-top:8px }
    .msg.error{ color:var(--danger) }
    .msg.ok{ color:var(--ok) }

    .legal{ font-size:12px; color:#6d788a; margin-top:8px }
    .skip{ display:inline-block; margin-top:10px; font-size:13px; opacity:.85; text-decoration: underline }

    /* Logo + responsividade extra */
    .logo{height:22px; display:block; margin:0 0 8px; opacity:.95}
    @media (max-width:520px){
      .modal .panel{padding:20px 18px; border-radius:14px}
      .row{gap:8px}
      input[type="email"], button{height:48px; font-size:16px}
    }
    @media (max-width:360px){ .modal .panel{width:96vw} }

    body.lock{ overflow:hidden }
  </style>
</head>
<body>
  <div class="page-wrap blurred" id="page">
    <div class="hero card">
      <div>
        <span class="badge">MedValor • Conteúdos</span>
        <h1>Acesso em um passo</h1>
        <p class="lead">Para abrir o conteúdo da MedValor, digite seu e‑mail. O acesso será liberado automaticamente.</p>
        <ul>
          <li>Materiais práticos e objetivos (ex.: 7 cursos gratuitos de instituições renomadas)</li>
          <li>Link único para não se perder em mil abas</li>
          <li>Missão: democratizar o acesso a bons conteúdos</li>
        </ul>
      </div>
      <div class="illus">
        <p class="lead" style="margin:0"><strong>Nota:</strong> se tiver indicações boas, responda ao e‑mail de confirmação e avaliamos incluir na lista.</p>
      </div>
    </div>
  </div>

  <!-- Overlay e Modal (obrigatório) -->
  <div class="overlay" id="overlay" aria-hidden="true"></div>
  <div class="modal" id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="panel" role="document">
      <img src="https://i.imgur.com/NQYipnw.png" alt="MedValor" class="logo" id="mv-logo" />
      <h2 id="modal-title">Abrir conteúdo agora</h2>
      <p>Digite seu e‑mail para liberar o link. É simples e direto.</p>
      <form id="leadForm" novalidate>
        <div class="row">
          <label class="sr-only" for="email" style="position:absolute;left:-9999px">Seu e‑mail</label>
          <input id="email" name="email" type="email" placeholder="voce@exemplo.com" autocomplete="email" required />
          <button id="submitBtn" type="submit">Acessar Agora</button>
        </div>
        <input type="text" name="website" id="website" tabindex="-1" autocomplete="off" aria-hidden="true" style="position:absolute;left:-9999px;height:0;width:0;opacity:0" />
        <div class="msg" id="msg" role="status" aria-live="polite"></div>
        <div class="legal">Ao enviar, você autoriza o uso do e‑mail para entregar este acesso e comunicações relacionadas. Consulte nossa <a href="https://drive.google.com/open?id=1Ty8w9SMiExHbpd_v8mbWGEQhOV1Ax73F&usp=drive_fsf" target="_blank" rel="noopener">Política de Privacidade</a>.</div>
        <a href="#" class="skip" id="skipLink" style="display:none">Prefiro continuar sem e‑mail</a>
      </form>
    </div>
  </div>

<script>
(function(){
  // ====== PARAMETRIZAÇÃO (replicável) ======
  const qs = new URLSearchParams(location.search);
  const WEBHOOK_URL = 'https:\/\/hook.us2.make.com\/wv7igcf7f1b2guv3bal4h8xjkcfeykx8';
  const REDIRECT_URL = qs.get('r') || 'https://hub.guithome.com.br/medvalor/cursosgratis.html';
  const TITLE        = qs.get('t') || 'Abrir conteúdo agora';
  const DESC         = qs.get('d') || 'Digite seu e‑mail para liberar o link. É simples e direto.';
  const LOGO_PARAM   = qs.get('logo');

  // ===== CAMPANHA (EDITE AQUI) =====
  // Substitua o valor abaixo sempre que mudar a campanha. Formato: AAA###-MM-YY
  const CAMPAIGN_CODE = 'CURSOSGRATIS-08-25';
  const CAMPAIGN_TAG  = 'MedValor_Content_Gate';

  const APPEND_UTM_TO_REDIRECT = true;
  const TIMEOUT_MS   = 4000;

  // ====== ELEMENTOS ======
  const page = document.getElementById('page');
  const overlay = document.getElementById('overlay');
  const modal = document.getElementById('modal');
  const modalTitle = document.getElementById('modal-title');
  const form = document.getElementById('leadForm');
  const emailInput = document.getElementById('email');
  const hp = document.getElementById('website'); // honeypot
  const msg = document.getElementById('msg');
  const submitBtn = document.getElementById('submitBtn');
  const skipLink = document.getElementById('skipLink');
  const logoEl = document.getElementById('mv-logo');

  // Títulos/descrições dinâmicos + botão + logo
  modalTitle.textContent = TITLE;
  modal.querySelector('p').textContent = DESC;
  if (logoEl){
    if (LOGO_PARAM === '0') logoEl.remove();
    else if (LOGO_PARAM) logoEl.src = LOGO_PARAM;
  }

  // Abre modal ao carregar
  function openModal(){
    document.body.classList.add('lock');
    page.classList.add('blurred');
    overlay.classList.add('show');
    modal.classList.add('show');
    setTimeout(()=> emailInput.focus(), 50);
  }
  openModal();

  // ====== Acessibilidade ======
  modal.addEventListener('keydown', function(e){
    if(e.key === 'Escape'){ e.preventDefault(); } // obrigatório: não fecha
    if(e.key !== 'Tab') return;
    const focusables = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    const first = focusables[0];
    const last = focusables[focusables.length - 1];
    if(!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
    else if(e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
  });

  // ====== Util ======
  const emailRx = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
  function setStatus(text, type){ msg.textContent = text || ''; msg.className = 'msg' + (type ? ' ' + type : ''); }
  function disableForm(disabled){ submitBtn.disabled = disabled; emailInput.disabled = disabled; }
  function buildRedirect(){
    const url = new URL(REDIRECT_URL, location.origin);
    if(APPEND_UTM_TO_REDIRECT){
      const utm = new URLSearchParams(location.search);
      for(const [k,v] of utm.entries()) if(!['w','r','t','d','logo','tag'].includes(k)) url.searchParams.set(k,v);
    }
    return url.toString();
  }
  function redirect(){
    const target = buildRedirect();
    setStatus('Abrindo…', 'ok');
    setTimeout(()=>{ location.assign(target); }, 250);
  }
  function saveLocal(email){ try{ localStorage.setItem('mv_email', email); }catch(_){ } }

  // ====== Envio ======
  form.addEventListener('submit', async function(e){
    e.preventDefault();
    if(hp.value){ return; } // bots
    const email = (emailInput.value || '').trim();
    if(!email || !emailRx.test(email)){
      setStatus('Digite um e‑mail válido.', 'error');
      emailInput.focus();
      return;
    }
    disableForm(true); setStatus('Enviando…');

    const payload = {
      email,
      ts: new Date().toISOString(),
      source: 'instagram',
      campaign: CAMPAIGN_TAG,
      campaign_code: CAMPAIGN_CODE,
      page: location.href,
      referrer: document.referrer || null,
      utm: Object.fromEntries(new URLSearchParams(location.search)),
      context: { brand: 'MedValor' }
    };

    const controller = new AbortController();
    const t = setTimeout(()=> controller.abort(), TIMEOUT_MS);

    try{
      const res = await fetch(WEBHOOK_URL, {
        method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload), signal:controller.signal, keepalive:true
      });
      clearTimeout(t);
      if(!res || !('ok' in res) || res.ok){ setStatus('Tudo certo. Abrindo…', 'ok'); saveLocal(email); redirect(); }
      else { setStatus('Não consegui confirmar o envio, mas vou abrir o link mesmo assim.', 'ok'); saveLocal(email); redirect(); }
    }catch(_){ setStatus('Conexão instável. Abrindo…', 'ok'); saveLocal(email); redirect(); }
  });
})();
</script>
</body>
</html>
